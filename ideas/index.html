<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Radar — Flight Labs</title>
    <meta name="description" content="Transmissions from the lab. Thoughts, case studies, and insights from Flight Labs.">

    <!-- Analytics -->
    <script defer src="https://data.flightlabs.agency/trackify.js" data-site-id="flightlabs-studio-o71c2"></script>

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://flightlabs.studio/ideas/">
    <meta property="og:title" content="The Radar — Flight Labs">
    <meta property="og:description" content="Transmissions from the lab. Thoughts, case studies, and insights.">
    <meta property="og:image" content="https://flightlabs.studio/socialshare.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="The Radar — Flight Labs">
    <meta name="twitter:description" content="Transmissions from the lab. Thoughts, case studies, and insights.">
    <meta name="twitter:image" content="https://flightlabs.studio/socialshare.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        dark: '#050505',
                        light: '#EDEDED',
                        accent: '#FF4F00',
                    }
                }
            }
        }
    </script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        ::selection { background: #FF4F00; color: #050505; }
        .border-glow {
            box-shadow: 0 0 0 1px rgba(255, 79, 0, 0.3);
        }
        .border-glow:hover {
            box-shadow: 0 0 20px rgba(255, 79, 0, 0.2), 0 0 0 1px rgba(255, 79, 0, 0.5);
        }
    </style>
</head>

<body class="bg-dark text-light font-sans antialiased">

    <!-- Nav -->
    <nav class="fixed top-0 left-0 w-full z-50 border-b border-light/10 bg-dark/80 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <a href="/" class="font-mono text-sm tracking-wider hover:text-accent transition-colors">
                [ FLIGHT LABS ]
            </a>
            <div class="hidden md:flex items-center gap-8 font-mono text-xs tracking-wider">
                <a href="/#hangar" class="hover:text-accent transition-colors">THE HANGAR</a>
                <a href="/#protocol" class="hover:text-accent transition-colors">THE PROTOCOL</a>
                <a href="/ideas/" class="text-accent">THE RADAR</a>
            </div>
            <a href="/#protocol" class="font-mono text-xs bg-accent text-dark px-4 py-2 hover:bg-light transition-colors">
                [ INITIATE PROTOCOL ]
            </a>
        </div>
    </nav>

    <!-- Hero -->
    <section class="pt-32 pb-16 px-6 border-b border-light/10">
        <div class="max-w-7xl mx-auto">
            <span class="font-mono text-xs text-accent tracking-widest mb-6 block">TRANSMISSIONS FROM THE LAB</span>
            <h1 class="text-5xl md:text-6xl lg:text-7xl font-black mb-6">THE RADAR</h1>
            <p class="text-light/60 text-lg max-w-xl">
                Thoughts, case studies, and insights. Unfiltered dispatches from the build floor.
            </p>
        </div>
    </section>

    <!-- Blog Grid -->
    <section class="py-16 px-6">
        <div class="max-w-7xl mx-auto">
            <div id="blog-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Loading state -->
                <div class="col-span-full text-center py-16">
                    <p class="font-mono text-sm text-light/40">Loading transmissions...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="border-t border-light/10 py-12 px-6 mt-auto">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                <div class="flex flex-col md:flex-row items-center gap-4 md:gap-8">
                    <a href="/" class="font-mono text-sm tracking-wider hover:text-accent transition-colors">[ FLIGHT LABS ]</a>
                    <span class="font-mono text-xs text-light/40">DIGITAL PRODUCT STUDIO</span>
                </div>
                <div class="flex items-center gap-8 font-mono text-xs text-light/40">
                    <a href="/ideas/" class="text-accent">THE RADAR</a>
                    <a href="/#hangar" class="hover:text-accent transition-colors">THE HANGAR</a>
                    <a href="/#protocol" class="hover:text-accent transition-colors">THE PROTOCOL</a>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-light/10 text-center md:text-left">
                <p class="font-mono text-xs text-light/30">© 2024 FLIGHT LABS. ALL SYSTEMS OPERATIONAL.</p>
            </div>
        </div>
    </footer>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://nckdgmtgdwhraspjynwd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ja2RnbXRnZHdocmFzcGp5bndkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1ODgyOTEsImV4cCI6MjA4MTE2NDI5MX0._JQQ6JurL-fDuJiYw2oqTmw_IQfLzmlJbklYfddVYY8';
        
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }).toUpperCase();
        }

        function getReadingTime(content) {
            const wordsPerMinute = 200;
            const text = content.replace(/<[^>]*>/g, '');
            const words = text.trim().split(/\s+/).length;
            const minutes = Math.ceil(words / wordsPerMinute);
            return `${minutes} MIN READ`;
        }

        // Load blog posts
        async function loadBlogPosts() {
            try {
                const { data: posts, error } = await supabaseClient
                    .from('blog_posts')
                    .select('*')
                    .eq('published', true)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const blogGrid = document.getElementById('blog-grid');
                
                if (!posts || posts.length === 0) {
                    blogGrid.innerHTML = `
                        <div class="col-span-full text-center py-16">
                            <p class="font-mono text-sm text-light/40">No transmissions yet. Check back soon.</p>
                        </div>
                    `;
                    return;
                }

                blogGrid.innerHTML = posts.map((post, index) => `
                    <a href="/ideas/${post.slug}.html" class="group border border-light/10 hover:border-accent/50 transition-all duration-300 border-glow block overflow-hidden">
                        ${post.featured_image ? `
                            <div class="aspect-video bg-dark overflow-hidden border-b border-light/10">
                                <img src="${post.featured_image}" alt="${post.title}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500">
                            </div>
                        ` : `
                            <div class="aspect-video bg-gradient-to-br from-dark to-light/5 border-b border-light/10 flex items-center justify-center">
                                <span class="font-mono text-6xl text-light/10">${String(index + 1).padStart(2, '0')}</span>
                            </div>
                        `}
                        <div class="p-6">
                            <div class="flex items-center gap-3 font-mono text-xs text-light/40 mb-4">
                                <span>${formatDate(post.created_at)}</span>
                                <span class="text-accent">◆</span>
                                <span>${getReadingTime(post.content)}</span>
                            </div>
                            <h2 class="text-xl font-bold mb-3 group-hover:text-accent transition-colors">${post.title}</h2>
                            <p class="text-light/60 text-sm line-clamp-2">${post.excerpt || post.content.replace(/<[^>]*>/g, '').substring(0, 120) + '...'}</p>
                        </div>
                    </a>
                `).join('');
            } catch (error) {
                console.error('Error loading posts:', error);
                document.getElementById('blog-grid').innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <p class="font-mono text-sm text-red-500">Error loading transmissions. Please try again later.</p>
                    </div>
                `;
            }
        }

        loadBlogPosts();
    </script>
</body>
</html>
